/*!
cbx-tree v2.0.0
https://amphiluke.github.io/cbx-tree/
(c) 2025 Amphiluke
*/
const e=(e,i=!0)=>`\n<ul part="tree" role="${i?"tree":"group"}">\n  ${[...e.values()].reduce((e,i)=>e+t(i),"")}\n</ul>`,t=({id:t,title:s,icon:r,collapsed:a,children:n})=>`\n<li id="item_${t}" part="item" role="treeitem" aria-expanded="${void 0===a?"undefined":!a}">\n  ${void 0!==n?'<button type="button" part="toggle" tabindex="-1"></button>':""}\n  <label part="label">\n    <input type="checkbox" id="cbx_${t}" part="checkbox" tabindex="-1">\n    ${i(r)}\n    <span part="title">${s}</span>\n  </label>\n  ${n?.size>0?e(n,!1):""}\n</li>`,i=e=>e?e.startsWith("<svg ")&&e.endsWith("</svg>")?'<svg part="icon"'+e.slice(4):`<img src="${(e=>["&",'"'].reduce((e,t)=>e.replaceAll(t,`&#${t.charCodeAt(0)};`),e))(e)}" alt="" part="icon">`:"",s=e=>e?.slice(e.indexOf("_")+1),r=e=>{if(!Array.isArray(e))throw new TypeError("Tree data must be an array of tree items")},a=new CSSStyleSheet;a.replaceSync(':host{--cbx-tree-toggle-closed-mask: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 14" width="8" height="14"><path d="M1.5 2.5v9L7 7z"/></svg>\');--cbx-tree-toggle-open-mask: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 8" width="14" height="8"><path d="M2.5 1.5h9L7 7z"/></svg>\');--cbx-tree-toggle-pending-mask: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path d="M7 1A6 6 0 1 1 1 7" fill="none" stroke="black" stroke-width="2"><animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 7 7" to="360 7 7" dur="1s" repeatCount="indefinite"/></path></svg>\');--cbx-tree-label-focus-bg: SelectedItem;--cbx-tree-label-focus-fg: SelectedItemText;--cbx-tree-nesting-indent: 1em}:host(:dir(rtl)){--cbx-tree-toggle-closed-mask: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 14" width="8" height="14"><path d="M6.5 2.5v9L1 7z"/></svg>\')}:host(:not([hidden])){display:block}[part=tree]{list-style:none;margin:0;padding:0;&:has([inert]){cursor:progress}&:not([part=tree] [part=tree]){overflow-x:clip}}[part=item]{align-items:center;display:grid;gap:0 .6ch;grid-template-areas:"toggle label" "tree   tree";grid-template-columns:max(1em,16px) 1fr;&[aria-expanded=false]>[part=tree]{display:none}}[part=toggle]{background:none;border:none;color:inherit;font:inherit;grid-area:toggle;height:max(1em,16px);padding:0;position:relative;width:max(1em,16px);z-index:1;&:not(:disabled){cursor:pointer}&:before{background:currentColor;content:"";inset:-4px;mask:var(--cbx-tree-toggle-closed-mask) 50% 50% / contain no-repeat content-box;padding:4px;position:absolute}[aria-expanded=true]>&:before{mask-image:var(--cbx-tree-toggle-open-mask)}[inert]>&:before{mask-image:var(--cbx-tree-toggle-pending-mask)}&:has(+[part=label]:focus):before{color:var(--cbx-tree-label-focus-fg)}}[part=label]{align-items:inherit;display:flex;gap:inherit;grid-area:label;isolation:isolate;outline:none;padding-block:.2em;position:relative;&:focus{color:var(--cbx-tree-label-focus-fg);&:before{background:var(--cbx-tree-label-focus-bg)}}&:before{content:"";inset:0;inset-inline-start:-100vw;position:absolute;z-index:-1}}:where([part=item]) [part=tree]{grid-area:tree;padding-inline-start:var(--cbx-tree-nesting-indent)}');class n extends HTMLElement{static get formAssociated(){return!0}static get observedAttributes(){return["nohover"]}#e;#t;#i=new Map;#s=new Set;#r=null;get#a(){return this.#e.querySelector('[tabindex="0"]')}set#a(e){const t=this.#a;e!==t&&(t?.removeAttribute("tabindex"),e?.setAttribute("tabindex","0"))}get#n(){return[...this.#e.querySelectorAll('[part="label"]:not([aria-expanded="false"] [part="tree"] *)')]}subtreeProvider=null;get formData(){const e=new FormData,{name:t}=this;return this.#s.forEach(i=>{const s=this.#o(i)?.value;void 0!==s&&e.append(t,s)}),e}get form(){return this.#t.form}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get noHover(){return this.hasAttribute("nohover")}set noHover(e){e?this.setAttribute("nohover",""):this.removeAttribute("nohover")}get type(){return this.localName}constructor(){super(),this.#e=this.attachShadow({mode:"open"}),this.#e.adoptedStyleSheets=[a],this.#t=this.attachInternals(),this.setData(this.#l()),this.hasAttribute("tabindex")||(this.tabIndex=0),this.#e.addEventListener("change",e=>this.#h(e)),this.#e.addEventListener("click",e=>this.#c(e)),this.addEventListener("focus",()=>this.#d()),this.#e.addEventListener("keydown",e=>this.#u(e)),this.#p()}attributeChangedCallback(e){"nohover"===e&&this.#p()}formDisabledCallback(e){this.#g(e)}formResetCallback(){this.setData(this.#l())}formStateRestoreCallback(e,t){if("restore"===t)try{this.setData(JSON.parse(e))}catch(e){console.warn("Failed to restore the tree state",e)}}#h({target:e}){if(e.part.contains("checkbox")){this.#b(e);const t=e.closest('[part="label"]');return void this.#m(t,!0)}}#c({target:e}){e.part.contains("toggle")&&this.#v(e.closest('[part="item"]'))}#d(){this.#a?.focus()}#u(e){if(!e.defaultPrevented&&!this.disabled){switch(e.key){case"ArrowRight":{const e=this.#a?.closest('[part="item"]');"true"===e?.ariaExpanded?this.#x():"false"===e?.ariaExpanded&&this.#v(e);break}case"ArrowLeft":{const e=this.#a?.closest('[part="item"]');"true"===e?.ariaExpanded?this.#v(e):this.#f();break}case"ArrowDown":this.#x();break;case"ArrowUp":this.#k();break;case"PageDown":this.#w();break;case"PageUp":this.#y();break;case"Home":this.#S();break;case"End":this.#E();break;case"Enter":{const e=this.#a?.closest('[part="item"]');"undefined"!==e.ariaExpanded&&this.#v(e);break}case" ":{const e=this.#a?.querySelector('[part="checkbox"]');e&&(e.checked=!e.checked,e.indeterminate=!1,this.#b(e));break}default:return}e.preventDefault()}}#A({target:e}){const t=e.closest('[part="label"]');this.#m(t,!0)}#p(){this.#r?.abort(),this.noHover?this.#r=null:(this.#r=new AbortController,this.#e.addEventListener("pointerover",e=>this.#A(e),{signal:this.#r.signal}))}#$(){this.#e.setHTMLUnsafe(e(this.#i)),[...this.#e.querySelectorAll('[part="checkbox"]')].forEach(e=>{const t=this.#o(s(e.id))?.state;e.checked="checked"===t,e.indeterminate="indeterminate"===t}),this.#a=this.#e.querySelector('[part="label"]')}#M(e,t){return new Map(e.map((e,i)=>{const s=t?`${t}:${i}`:String(i);e.checked&&this.#s.add(s);const r={id:s,title:e.title,value:e.value,icon:e.icon,collapsed:e.children?.length?!!e.collapsed:null===e.children||void 0,children:e.children?this.#M(e.children,s):e.children};return Object.defineProperty(r,"state",{get:()=>this.#s.has(r.id)?"checked":r.children?.size?this.#C(r):"unchecked"}),[s,r]}))}async#D(t){if("function"!=typeof this.subtreeProvider)return;const i=this.#o(t);if(null!==i?.children)return;const s=this.#e.getElementById(`item_${t}`);s.inert=!0;try{const e=await this.subtreeProvider(i.value);r(e),i.children=this.#M(e,i.id)}finally{s.inert=!1}i.children.size&&(s.insertAdjacentHTML("beforeend",e(i.children,!1)),this.disabled&&this.#g(!0,s),this.#L(i),this.#O())}#o(e){const t=e.split(":");return t.slice(1).reduce((e,t)=>e?.children?.get(`${e?.id}:${t}`),this.#i.get(t[0]))}#C(e){const t=new Set([...e.children.values()].map(({state:e})=>e));return t.has("indeterminate")?"indeterminate":t.has("checked")?t.has("unchecked")?"indeterminate":"checked":"unchecked"}#H(e,t){if(!t?.size)return;const i=e?"add":"delete";t.forEach((t,s)=>{this.#s[i](s);const r=this.#e.getElementById(`cbx_${s}`);r.checked=e,r.indeterminate=!1,this.#H(e,t.children)})}#g(e,t=this.#e){[...t.querySelectorAll("button, input")].forEach(t=>t.disabled=e)}#L(e){e.children&&this.#H(this.#s.has(e.id),e.children)}#q(e){if(this.#i.has(e.id))return;const t=this.#o(e.id.slice(0,e.id.lastIndexOf(":"))),i=this.#C(t);this.#s["checked"===i?"add":"delete"](t.id);const s=this.#e.getElementById(`cbx_${t.id}`);s.checked="checked"===i,s.indeterminate="indeterminate"===i,this.#q(t)}#O(){this.#t.setFormValue(this.formData,JSON.stringify(this))}#b(e){const t=s(e.id),i=e.checked?"add":"delete";this.#s[i](t);const r=this.#o(t);this.#L(r),this.#q(r),this.#O(),this.dispatchEvent(new CustomEvent("cbxtreechange",{bubbles:!0,detail:this.formData}))}#v(e){const t="true"!==e.ariaExpanded;e.ariaExpanded=t?"true":"false";const i=s(e.id);t&&this.#D(i);const r=this.#o(i);r.collapsed=!t,this.#a=e.querySelector('[part="label"]'),this.#O(),this.dispatchEvent(new CustomEvent("cbxtreetoggle",{bubbles:!0,detail:{title:r.title,value:r.value,newState:t?"expanded":"collapsed"}}))}#m(e,t=!1){e&&(this.#a=e,e.focus({preventScroll:t}))}#S(){const e=this.#e.querySelector('[part="label"]');this.#m(e)}#E(){const e=this.#n.at(-1);this.#m(e)}#x(){const e=this.#a;if(!e)return void this.#S();const t=this.#n,i=t[t.indexOf(e)+1];this.#m(i)}#k(){const e=this.#a;if(!e)return void this.#S();const t=this.#n,i=t[t.indexOf(e)-1];this.#m(i)}#w(){const{clientHeight:e,scrollHeight:t}=this;if(t-e<10)return void this.#E();const i=this.#n,s=t/i.length,r=Math.floor(e/s);let a=i.indexOf(this.#a);-1===a&&(a=0);const n=Math.min(a+r-1,i.length-1);this.#m(i[n])}#y(){const{clientHeight:e,scrollHeight:t}=this;if(t-e<10)return void this.#S();const i=this.#n,s=t/i.length,r=Math.round(e/s);let a=i.indexOf(this.#a);-1===a&&(a=0);const n=Math.max(a-r+1,0);this.#m(i[n])}#f(){const e=this.#a;if(!e)return void this.#S();const t=e.closest('[part="tree"]').closest('[part="item"]')?.querySelector('[part="label"]');this.#m(t)}#l(){const e=this.textContent.trim()||"[]";try{const t=JSON.parse(e);return r(t),t}catch{return console.error(new DOMException("<cbx-tree> contents must be a valid JSON array representation","DataError")),[]}}#T(e=this.#i){return[...e.values()].map(e=>({title:e.title,value:e.value,icon:e.icon,checked:this.#s.has(e.id),collapsed:!0===e.collapsed||void 0,children:e.children?this.#T(e.children):e.children}))}setData(e){r(e),this.#s.clear(),this.#i=this.#M(e),this.#$(),this.#O()}toJSON(){return this.#T()}toggleChecked(e){void 0===e&&(e=!!this.#e.querySelector('[part="checkbox"]:not(:checked)')),this.#H(e,this.#i),this.#O()}toggle(e){let t=[...this.#e.querySelectorAll('[part="item"]:has([part="tree"])')];void 0===e&&(e=t.some(({ariaExpanded:e})=>"false"===e));const i=String(e);t.forEach(t=>{if(t.ariaExpanded===i)return;t.ariaExpanded=i;this.#o(s(t.id)).collapsed=!e}),this.#O()}get validity(){return this.#t.validity}get validationMessage(){return this.#t.validationMessage}get willValidate(){return this.#t.willValidate}checkValidity(){return this.#t.checkValidity()}reportValidity(){return this.#t.reportValidity()}setValidity(...e){return this.#t.setValidity(...e)}}customElements.define("cbx-tree",n);export{n as default};