/*!
cbx-tree v1.0.0
https://github.com/Amphiluke/cbx-tree#readme
(c) 2025 Amphiluke
*/
const e=e=>["&",'"'].reduce(((e,t)=>e.replaceAll(t,`&#${t.charCodeAt(0)};`)),e),t=e=>`\n<ul part="tree">\n  ${[...e.values()].reduce(((e,t)=>e+i(t)),"")}\n</ul>`,i=({id:i,value:r,title:a,icon:s,children:n})=>`\n<li part="item">\n  ${n?.size>0?'<button type="button" part="toggle"></button>':""}\n  <label part="label">\n    <input type="checkbox" id="cbx_${i}" value="${e(r)}" part="checkbox">\n    ${s?`<img src="${e(s)}" alt="" part="icon">`:""}\n    <span part="title">${a}</span>\n  </label>\n  ${n?.size>0?t(n):""}\n</li>`,r=new CSSStyleSheet;r.replaceSync('[part=tree]{list-style:none;margin:0;padding:0}[part=item]{align-items:center;display:grid;gap:.4em .6ch;grid-template-areas:"toggle label" "tree   tree";grid-template-columns:1em 1fr}[part=toggle]{grid-area:toggle}[part=label]{align-items:inherit;display:flex;gap:inherit;grid-area:label}:where([part=item]) [part=tree]{grid-area:tree;padding-inline-start:1em}');class a extends HTMLElement{static get formAssociated(){return!0}#e;#t;#i=new Map;#r=new Set;get formData(){const e=new FormData,{name:t}=this;return this.#r.forEach((i=>e.append(t,i))),e}get form(){return this.#t.form}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get type(){return this.localName}constructor(){super(),this.#e=this.attachShadow({mode:"open",delegatesFocus:!0}),this.#e.adoptedStyleSheets=[r],this.#t=this.attachInternals(),this.#i=this.#a(this.#s()),this.#n(),this.#e.addEventListener("change",(({target:e})=>{const t=e.id.slice(4),i=e.checked?"add":"delete";this.#r[i](t);const r=this.#h(t);this.#c(r),this.#l(r),this.#t.setFormValue(this.formData,JSON.stringify([...this.#i]))}))}formResetCallback(){this.#i=this.#a(this.#s()),this.#n()}formStateRestoreCallback(e,t){if("restore"===t)try{this.#i=new Map(JSON.parse(e)),this.#n()}catch(e){console.warn("Failed to restore the tree state",e)}}#n(){this.#e.setHTMLUnsafe(t(this.#i))}#a(e,t){return new Map(e.map(((e,i)=>{const r=t?`${t}:${i}`:String(i);e.checked&&this.#r.add(r);const a={id:r,title:e.title,value:e.value,icon:e.icon,children:e.children?this.#a(e.children,r):e.children};return Object.defineProperty(a,"state",{get:()=>this.#r.has(a.id)?"checked":a.children?.size?this.#d(a):"unchecked"}),[r,a]})))}#h(e){const t=e.split(":");return t.slice(1).reduce(((e,t)=>e?.children?.get(`${e?.id}:${t}`)),this.#i.get(t[0]))}#d(e){const t=new Set([...e.children.values()].map((({state:e})=>e)));return t.has("indeterminate")?"indeterminate":t.has("checked")?t.has("unchecked")?"indeterminate":"checked":"unchecked"}#c(e){if(this.#i.has(e.id))return;const t=this.#h(e.id.slice(0,e.id.lastIndexOf(":"))),i=this.#d(t);this.#r["checked"===i?"add":"delete"](t.id);const r=this.#e.getElementById(`cbx_${t.id}`);r.checked="checked"===i,r.indeterminate="indeterminate"===i,this.#c(t)}#l(e){if(!e.children)return;const t=this.#r.has(e.id),i=t?"add":"delete";e.children.forEach(((e,r)=>{this.#r[i](r);const a=this.#e.getElementById(`cbx_${r}`);a.checked=t,a.indeterminate=!1,this.#l(e)}))}#s(){const e=this.textContent.trim()||"[]";try{const t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError;return t}catch{return console.error(new DOMException("<cbx-tree> contents must be a valid JSON array representation","DataError")),[]}}setData(e){if(!Array.isArray(e))throw new TypeError("Tree data must be an array of tree items");this.#i=this.#a(e),this.#n()}toJSON(){return structuredClone(this.#i)}get validity(){return this.#t.validity}get validationMessage(){return this.#t.validationMessage}get willValidate(){return this.#t.willValidate}checkValidity(){return this.#t.checkValidity()}reportValidity(){return this.#t.reportValidity()}setValidity(...e){return this.#t.setValidity(...e)}}customElements.define("cbx-tree",a);export{a as default};